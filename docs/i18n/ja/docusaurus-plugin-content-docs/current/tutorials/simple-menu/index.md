---
sidebar_position: 1
sidebar_label: 簡単な表情メニューを作る
---
 
 # 簡単な表情メニューを作る

本ツールによる表情メニュー作成のサンプルとして、「どちらかの手のジェスチャーが Victory のとき笑顔になる」表情メニューを作ってみましょう。

## 表情メニューを新規作成する

ヒエラルキー上にアバターが置かれているとき、アバターの右端に本ツールのアイコンが表示されます。 

![起動アイコン](launch_icon.png)

アイコンをクリックすると、「FaceEmo」という名前のオブジェクトが作成され、本ツールのウインドウが開きます。

![FaceEmo起動](launch_face_emo.png)

:::tip
表情メニューは、ここで作成される「FaceEmo」オブジェクトに保存されています。  
「FaceEmo」オブジェクトがすでに存在するときにアイコンをクリックすると、保存されている表情メニューが開かれます。  
アバターが複数存在する場合の挙動など、詳しい仕様については[リファレンス > 表情メニュー](../../reference/menu)で説明しています。
:::

---
## 表情パターンを追加する

「表情パターン」ビューの一番左のボタンをクリックすると、表情パターンが追加されます。

![パターン追加](add_pattern.png)

表情パターンの名前を「笑顔」に変更します。

![パターン名変更](modify_pattern_name.png)

:::tip
表情パターンを追加することで、Expression Menu を使用した表情パターン切り替えが設定できます。  
表情パターンについては、[リファレンス > 表情パターン](../../reference/pattern)で詳しく説明しています。
:::

---
## 表情を追加する

表情パターンを追加すると、「表情」ビューに「画面上部のボタンを押して表情を追加できます。」と表示されるようになるので、「表情ビュー」の右上にあるボタンを押して表情を追加します。

![表情追加前](add_expression_before.png)
![表情追加後](add_expression_after.png)

「条件」を「片手または両手が」「Victory」「と一致」に変更します。

![条件の変更](modify_condition.png)

:::tip
表情を追加することで、ハンドジェスチャーによる表情切り替えが設定できます。  
表情については、[リファレンス > 表情](../../reference/expression)で詳しく説明しています。
:::

---
## 表情アニメーションを作成する

表情サムネイルにカーソルを合わせるとボタンが表示されるので、左上のボタンを押します。

![クリップ追加ボタン](add_clip_button.png)

表情アニメーションの保存場所を指定するウインドウが表示されるので、名前を「笑顔」に変更して「保存」ボタンを押します。

![クリップ保存ダイアログ](clip_save_dialog.png)

表情アニメーションが作成されると、本ツールの表情エディタが開きます。

![表情エディタ起動](launch_expression_editor.png)

:::tip
シェイプキーの区切り文字を入力することで、シェイプキーをカテゴリごとに表示することができます。

- シェイプキーの区切り文字はアバターごとに異なります
    - 「=====Eye=====」のようなカテゴリ名となっている場合、「=====」と入力してください
    - 「\*\*\*\*\*Eye\*\*\*\*\*」のようなカテゴリ名となっている場合、「\*\*\*\*\*」と入力してください

![シェイプキー区切り文字](blendshape_delimiter.png)
:::


「▶」をクリックするとシェイプキーのカテゴリが開き、シェイプキーの名前がリストで表示されます。  
表情アニメーションに追加したいシェイプキーをクリックするとシェイプキーが追加され、プレビューが更新されます。

- シェイプキーの値を変更したい場合、各シェイプキーのスライダーを動かすか、テキストボックスに数値を入力します

![シェイプキー追加](add_blendshape.png)

:::caution
シェイプキーを追加したとき、下記の警告が出ていないか確認してください。
- 「まばたき用シェイプキーが含まれています！」 -  まばたきアニメーションに上書きされ、表情アニメーションが正しく再生されない可能性があります
- 「リップシンク用シェイプキーが含まれています！」 -  リップシンクが正しく動かなくなる可能性があります
:::

プレビュー画面は、Unityのシーンビューと同様の操作で移動・回転・拡大縮小することが可能です。

![表情エディタプレビュー](preview_expression_editor.png)

:::tip
プレビュー画面のカメラ設定はシーンビューの設定を引き継ぎます。  
たとえば、シーンビューでFOVを変更して作業している場合、プレビュー画面にも変更したFOVが適用されます。
:::

笑顔の表情アニメーションを再生しているときにまばたきが発生すると表情が破綻してしまうので、「まばたき有効」をオフにします。

![まばたき無効化](disable_blink.png)

---
## 表情メニューをアバターに適用する

「アバターに適用」ボタンをクリックすると確認ウインドウが表示されるので、「適用」をクリックします。

![アバターに適用](apply_to_avatar.png)

「表情メニューの生成が完了しました！」と表示されれば表情メニューの作成は完了です。

- この状態でアバターをアップロードすると、Modular Avatarによって表情メニューがアバターに合成されます
- ヒエラルキーでアバターの中身を確認すると、「FaceEmoPrefab」というオブジェクトが追加されています
    - アバターから表情メニューを削除したい場合は、このオブジェクトを削除してください

![適用完了](application_completed.png)
![FaceEmoPrefab](face_emo_prefab.png)

:::caution
### アップロードできない場合

下図のようなエラーが発生する場合、VRCSDKがModular Avatarに対応したバージョンになっていない可能性があります。  
VRCSDKとModular Avatarを最新版にアップデートしてみてください。

![VRCSDKのエラー](sdk_error.png)

:::

どちらかの手のジェスチャーが Victory のとき、表情が笑顔になることを確認してください。

![GestureManagerでプレビュー](preview_in_gesture_manager.png)

:::caution
### Gesture Managerでプレビューする場合の注意事項

- Gesture Manager や Modular Avatar のバージョンによっては、プレビューに表情メニューが適用されない場合があります。その場合は下記の手順を試してみてください
    - Gesture Managerのオブジェクトを選択していない状態で、UnityのPlayボタンを押す
    - Playモードに入ってから、Gesture Managerのオブジェクトを選択する
    - Gameタブでアバターがうまく表示されない場合は、Sceneタブでプレビューを確認する
- AFKモーションが再生されてしまう場合、ActionレイヤーのParametersを開いてAFKのチェックをオフにしてください

![Actionレイヤー](action_layer.png)
:::
